#!/usr/bin/env bash

# Pre-commit hook for the F1 Love2D project
# This hook runs Lua syntax checks on staged .lua files before each commit.

echo "üîç Running Lua pre-commit checks..."

# Check if luac (Lua compiler) is available
if ! command -v luac >/dev/null 2>&1; then
  echo "‚ö†Ô∏è  'luac' is not installed or not in PATH."
  echo "    Skipping Lua syntax checks. Install Lua to enable this pre-commit hook."
  exit 0
fi

# Collect staged Lua files
lua_files=$(git diff --cached --name-only -- '*.lua')

if [ -z "$lua_files" ]; then
  echo "‚úÖ No Lua files staged. Skipping Lua checks."
  exit 0
fi

echo "üìù Checking Lua syntax for staged files..."
failed=0

for file in $lua_files; do
  if [ -f "$file" ]; then
    echo "  ‚Ä¢ $file"
    if ! luac -p "$file"; then
      echo "‚ùå Syntax error in $file"
      failed=1
    fi
  fi
done

if [ "$failed" -ne 0 ]; then
  echo ""
  echo "‚ùå Lua syntax check failed. Please fix errors before committing."
  exit 1
fi

echo "‚úÖ All Lua syntax checks passed!"
exit 0
